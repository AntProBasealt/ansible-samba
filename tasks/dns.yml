---

- name: purge other resolv.conf`s
  command: >
    find /etc/net/ifaces -name resolv.conf -delete
  register: res
  changed when: res.rc == 0
  failed_when: false

- name: set master DC as the 1st nameserver
  template:
    src: resolv.conf.j2
    dest: /etc/net/ifaces/lo/resolv.conf

- name: black magic
  shell: update_chrooted all
  changed_when: false

- name: restart network service
  service:
    name: network
    state: restarted

- name: validate /etc/resolv.conf
  command: >
    grep -q -e 'nameserver {{ item }}' /etc/resolv.conf
  with_items:
    - "{{ samba_master_address }}"
    - "{{ samba_dns_forward }}"

